import{MeiliSearch as t}from"meilisearch";var e=function(){return e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},e.apply(this,arguments)};function n(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,s)}u((r=r.apply(t,e||[])).next())}))}function r(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function i(t,e,n){if(n||2===arguments.length)for(var r,i=0,a=e.length;i<a;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function a(t){return 180*t/Math.PI}function o(t){return t*Math.PI/180}function s(t){if(t){var e,n,r=t.insideBoundingBox,i=t.aroundLatLng,s=t.aroundRadius,u=t.minimumAroundRadius;if(i&&(e=i),null==s&&null==u||(n=null!=s?s:u),r&&"string"==typeof r){var c=r.split(","),l=c[0],f=c[1],h=c[2],d=c[3],g=[parseFloat(l),parseFloat(f),parseFloat(h),parseFloat(d)],p=g[0],v=g[1],y=g[2],P=g[3];n=function(t,e,n,r){var i=t*Math.PI/180,a=n*Math.PI/180,o=(n-t)*Math.PI/180,s=(r-e)*Math.PI/180,u=Math.sin(o/2)*Math.sin(o/2)+Math.cos(i)*Math.cos(a)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3}(p,v,y,P)/2,e=function(t,e,n,r){t=o(t),e=o(e);var i=Math.cos(t)*Math.cos(e),s=Math.cos(t)*Math.sin(e),u=Math.sin(t);n=o(n),r=o(r);var c=i+Math.cos(n)*Math.cos(r),l=s+Math.cos(n)*Math.sin(r),f=u+Math.sin(n),h=Math.sqrt(c*c+l*l),d=Math.atan2(l,c),g=Math.atan2(f,h);return e<r||e>r&&e>Math.PI&&r<-Math.PI?(g+=Math.PI,d+=Math.PI):(g=a(g),d=a(d)),Math.abs(c)<Math.pow(10,-9)&&Math.abs(l)<Math.pow(10,-9)&&Math.abs(f)<Math.pow(10,-9)&&(g=0,d=0),"".concat(g,",").concat(d)}(p,v,y,P)}if(null!=e&&null!=n){var m=e.split(","),b=m[0],M=m[1];return b=Number.parseFloat(b).toFixed(5),M=Number.parseFloat(M).toFixed(5),{filter:"_geoRadius(".concat(b,", ").concat(M,", ").concat(n,")")}}}}function u(t){return t.replace(/:(.*)/i,'="$1"')}function c(t){return"string"==typeof t?u(t):Array.isArray(t)?t.map((function(t){return Array.isArray(t)?t.map((function(t){return u(t)})).filter((function(t){return t})):u(t)})).filter((function(t){return t})):[]}function l(t){return""===t?[]:"string"==typeof t?[t]:t}function f(t,e,n){return function(t,e,n){var r=n.trim(),a=l(t),o=l(e);return i(i(i([],a,!0),o,!0),[r],!1).filter((function(t){return Array.isArray(t)?t.length:t}))}(c(n||[]),c(e||[]),t||"")}function h(t){var e={},n=t.facets,r=t.attributesToSnippet,i=t.snippetEllipsisText,a=t.attributesToRetrieve,o=t.attributesToHighlight,u=t.highlightPreTag,c=t.highlightPostTag,l=t.placeholderSearch,h=t.query,d=t.sort,g=t.pagination,p=t.matchingStrategy,v=f(t.filters,t.numericFilters,t.facetFilters);return{getParams:function(){return e},addFacets:function(){Array.isArray(n)?e.facets=n:"string"==typeof n&&(e.facets=[n])},addAttributesToCrop:function(){r&&(e.attributesToCrop=r)},addCropMarker:function(){null!=i&&(e.cropMarker=i)},addAttributesToRetrieve:function(){a&&(e.attributesToRetrieve=a)},addFilters:function(){v.length&&(e.filter=v)},addAttributesToHighlight:function(){e.attributesToHighlight=o||["*"]},addPreTag:function(){e.highlightPreTag=u||"__ais-highlight__"},addPostTag:function(){e.highlightPostTag=c||"__/ais-highlight__"},addPagination:function(){var t=function(t,e,n){return!!(n||e||t&&0!==t.length)}(v,h,l);if(g.finite){var n=function(t,e){var n=t.page,r=t.hitsPerPage;return e?{hitsPerPage:r,page:n+1}:{hitsPerPage:0,page:n+1}}(g,t),r=n.hitsPerPage,i=n.page;e.hitsPerPage=r,e.page=i}else{var a=function(t,e){var n=t.page,r=t.hitsPerPage;return e?{limit:r+1,offset:n*r}:{limit:0,offset:0}}(g,t),o=a.limit,s=a.offset;e.limit=o,e.offset=s}},addSort:function(){(null==d?void 0:d.length)&&(e.sort=[d])},addGeoSearchRules:function(){var n=function(t){var e={},n=t.aroundLatLng,r=t.aroundLatLngViaIP,i=t.aroundRadius,a=t.aroundPrecision,o=t.minimumAroundRadius,s=t.insideBoundingBox,u=t.insidePolygon;return n&&(e.aroundLatLng=n),r&&console.warn("instant-meilisearch: `aroundLatLngViaIP` is not supported."),i&&(e.aroundRadius=i),a&&console.warn("instant-meilisearch: `aroundPrecision` is not supported.\n    See this discussion to track its implementation https://github.com/meilisearch/product/discussions/264"),o&&(e.minimumAroundRadius=o),s&&(e.insideBoundingBox=s),u&&console.warn("instant-meilisearch: `insidePolygon` is not implented in instant-meilisearch."),e}(t),r=s(n);(null==r?void 0:r.filter)&&(e.filter?e.filter.unshift(r.filter):e.filter=[r.filter])},addMatchingStrategy:function(){p&&(e.matchingStrategy=p)}}}function d(t){return"string"==typeof t?t:void 0===t?JSON.stringify(null):JSON.stringify(t)}function g(t){return Array.isArray(t)?t.map((function(t){return g(t)})):"object"!=typeof(e=t)||Array.isArray(e)||null===e?{value:d(t)}:Object.keys(t).reduce((function(e,n){return e[n]=g(t[n]),e}),{});var e}function p(t,e){var n=e.primaryKey,r=t.hits,i=e.pagination,a=i.finite,o=i.hitsPerPage;!a&&r.length>o&&r.splice(r.length-1,1);var s=r.map((function(t){if(Object.keys(t).length>0){var e=t._formatted;t._matchesPosition;var r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(t,["_formatted","_matchesPosition"]),i=Object.assign(r,function(t){if(!t)return{};var e=g(t);return{_highlightResult:e,_snippetResult:e}}(e));return n&&(i.objectID=t[n]),i}return t}));return s=function(t){for(var e,n=0;n<t.length;n++){var r="".concat(n+1e6*Math.random());t[n]._geo&&(t[n]._geoloc=t[n]._geo,t[n].objectID=r),(null===(e=t[n]._formatted)||void 0===e?void 0:e._geo)&&(t[n]._formatted._geoloc=t[n]._formatted._geo,t[n]._formatted.objectID=r)}return t}(s),s}function v(t){void 0===t&&(t={});var e=t;return{getEntry:function(t){if(e[t])try{return JSON.parse(e[t])}catch(n){return e[t]}},formatKey:function(t){return t.reduce((function(t,e){return t+JSON.stringify(e)}),"")},setEntry:function(t,n){e[t]=JSON.stringify(n)},clearCache:function(){e={}}}}function y(t,i){return n(this,void 0,void 0,(function(){var n,a;return r(this,(function(r){switch(r.label){case 0:return n=e(e({},i),{placeholderSearch:!0,query:""}),(a=h(n)).addFacets(),a.addPagination(),[4,t.searchResponse(n,a.getParams())];case 1:return[2,r.sent().facetDistribution||{}]}}))}))}function P(t,e,i){return n(this,void 0,void 0,(function(){var n,a;return r(this,(function(r){switch(r.label){case 0:return i[e.indexUid]?[3,2]:(n=i,a=e.indexUid,[4,y(t,e)]);case 1:n[a]=r.sent(),r.label=2;case 2:return[2,i]}}))}))}var m;function b(i,a,o){void 0===a&&(a=""),void 0===o&&(o={}),function(t,e){if("string"!=typeof t)throw new TypeError("Provided hostUrl value (1st parameter) is not a string, expected string");if("string"!=typeof e&&"function"!=typeof e)throw new TypeError("Provided apiKey value (2nd parameter) is not a string or a function, expected string or function")}(i,a),a=function(t){if("function"==typeof t){var e=t();if("string"!=typeof e)throw new TypeError("Provided apiKey function (2nd parameter) did not return a string, expected string");return e}return t}(a);var s,u,c=function(t){void 0===t&&(t=[]);var e="Meilisearch instant-meilisearch (v".concat("0.11.0",")");return t.concat(e)}(o.clientAgents),l=new t({host:i,apiKey:a,clientAgents:c}),f=v(),d=(s=l,u=f,{searchResponse:function(t,e){return n(this,void 0,void 0,(function(){var n,i,a;return r(this,(function(r){switch(r.label){case 0:return n=u.formatKey([e,t.indexUid,t.query,t.pagination]),(i=u.getEntry(n))?[2,i]:[4,s.index(t.indexUid).search(t.query,e)];case 1:return a=r.sent(),u.setEntry(n,a),[2,a]}}))}))}}),g={};return{clearCache:function(){return f.clearCache()},search:function(t){return n(this,void 0,void 0,(function(){var n,i,a,s,u,c,l,f,v;return r(this,(function(r){switch(r.label){case 0:r.trys.push([0,6,,7]),n={results:[]},i=0,a=t,r.label=1;case 1:return i<a.length?(s=a[i],u=function(t,n){var r,i,a,o=t.indexName.split(":"),s=o[0],u=o.slice(1),c=t.params,l=(r=n.finitePagination,i=null==c?void 0:c.hitsPerPage,a=null==c?void 0:c.page,{hitsPerPage:void 0===i?20:i,page:a||0,finite:!!r});return e(e(e({},n),c),{sort:u.join(":")||"",indexUid:s,pagination:l,placeholderSearch:!1!==n.placeholderSearch,keepZeroFacets:!!n.keepZeroFacets})}(s,o),c=function(t){var e=h(t);return e.addFacets(),e.addAttributesToHighlight(),e.addPreTag(),e.addPostTag(),e.addAttributesToRetrieve(),e.addAttributesToCrop(),e.addCropMarker(),e.addPagination(),e.addFilters(),e.addSort(),e.addGeoSearchRules(),e.addMatchingStrategy(),e.getParams()}(u),[4,P(d,u,g)]):[3,5];case 2:return g=r.sent(),[4,d.searchResponse(u,c)];case 3:l=r.sent(),f=function(t,n,r){var i=t.processingTimeMs,a=t.query,o=t.facetDistribution,s=n.keepZeroFacets,u=n.facets,c=function(t,e){var n=e.hitsPerPage,r=e.page,i=function(t,e){if(null!=t.totalPages)return t.totalPages;if(0===e)return 0;var n=t.limit,r=void 0===n?20:n,i=t.offset;return(void 0===i?0:i)/e+1+(t.hits.length>=r?1:0)}(t,n);return{page:r,nbPages:i,hitsPerPage:n}}(t,n.pagination),l=c.hitsPerPage,f=c.page,h=c.nbPages,d=p(t,n),g=function(t){var e=t.hitsPerPage,n=void 0===e?0:e,r=t.totalPages,i=void 0===r?0:r,a=t.estimatedTotalHits,o=t.totalHits;return null!=a?a:null!=o?o:n*i}(t),v=function(t,e,n,r){return t?function(t,e,n){for(var r=function(t){return t?"string"==typeof t?[t]:t:[]}(t),i={},a=0,o=r;a<o.length;a++){var s=o[a];for(var u in e[s])i[s]||(i[s]=n[s]||{}),i[s][u]?i[s][u]=n[s][u]:i[s][u]=0}return i}(e,n,r=r||{}):r}(s,u,r,o);return e({index:n.indexUid,hitsPerPage:l,page:f,facets:v,nbPages:h,nbHits:g,processingTimeMS:i,query:a,hits:d,params:"",exhaustiveNbHits:!1},{})}(l,u,g[s.indexName]),n.results.push(f),r.label=4;case 4:return i++,[3,1];case 5:return[2,n];case 6:throw v=r.sent(),console.error(v),new Error(v);case 7:return[2]}}))}))},searchForFacetValues:function(t){return n(this,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,e){e(new Error("SearchForFacetValues is not compatible with Meilisearch")),t([])}))];case 1:return[2,t.sent()]}}))}))}}}!function(t){t.ALL="all",t.LAST="last"}(m||(m={}));export{m as MatchingStrategies,b as instantMeiliSearch};
//# sourceMappingURL=instant-meilisearch.esm.min.js.map
