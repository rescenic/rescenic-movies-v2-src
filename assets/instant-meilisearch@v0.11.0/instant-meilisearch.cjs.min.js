"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("meilisearch"),e=function(){return e=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},e.apply(this,arguments)};function r(t,e,r,n){return new(r||(r=Promise))((function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}u((n=n.apply(t,e||[])).next())}))}function n(t,e){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function i(t,e,r){if(r||2===arguments.length)for(var n,i=0,a=e.length;i<a;i++)!n&&i in e||(n||(n=Array.prototype.slice.call(e,0,i)),n[i]=e[i]);return t.concat(n||Array.prototype.slice.call(e))}function a(t){return 180*t/Math.PI}function o(t){return t*Math.PI/180}function s(t){if(t){var e,r,n=t.insideBoundingBox,i=t.aroundLatLng,s=t.aroundRadius,u=t.minimumAroundRadius;if(i&&(e=i),null==s&&null==u||(r=null!=s?s:u),n&&"string"==typeof n){var c=n.split(","),l=c[0],f=c[1],h=c[2],d=c[3],g=[parseFloat(l),parseFloat(f),parseFloat(h),parseFloat(d)],p=g[0],v=g[1],y=g[2],P=g[3];r=function(t,e,r,n){var i=t*Math.PI/180,a=r*Math.PI/180,o=(r-t)*Math.PI/180,s=(n-e)*Math.PI/180,u=Math.sin(o/2)*Math.sin(o/2)+Math.cos(i)*Math.cos(a)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371e3}(p,v,y,P)/2,e=function(t,e,r,n){t=o(t),e=o(e);var i=Math.cos(t)*Math.cos(e),s=Math.cos(t)*Math.sin(e),u=Math.sin(t);r=o(r),n=o(n);var c=i+Math.cos(r)*Math.cos(n),l=s+Math.cos(r)*Math.sin(n),f=u+Math.sin(r),h=Math.sqrt(c*c+l*l),d=Math.atan2(l,c),g=Math.atan2(f,h);return e<n||e>n&&e>Math.PI&&n<-Math.PI?(g+=Math.PI,d+=Math.PI):(g=a(g),d=a(d)),Math.abs(c)<Math.pow(10,-9)&&Math.abs(l)<Math.pow(10,-9)&&Math.abs(f)<Math.pow(10,-9)&&(g=0,d=0),"".concat(g,",").concat(d)}(p,v,y,P)}if(null!=e&&null!=r){var m=e.split(","),b=m[0],M=m[1];return b=Number.parseFloat(b).toFixed(5),M=Number.parseFloat(M).toFixed(5),{filter:"_geoRadius(".concat(b,", ").concat(M,", ").concat(r,")")}}}}function u(t){return t.replace(/:(.*)/i,'="$1"')}function c(t){return"string"==typeof t?u(t):Array.isArray(t)?t.map((function(t){return Array.isArray(t)?t.map((function(t){return u(t)})).filter((function(t){return t})):u(t)})).filter((function(t){return t})):[]}function l(t){return""===t?[]:"string"==typeof t?[t]:t}function f(t,e,r){return function(t,e,r){var n=r.trim(),a=l(t),o=l(e);return i(i(i([],a,!0),o,!0),[n],!1).filter((function(t){return Array.isArray(t)?t.length:t}))}(c(r||[]),c(e||[]),t||"")}function h(t){var e={},r=t.facets,n=t.attributesToSnippet,i=t.snippetEllipsisText,a=t.attributesToRetrieve,o=t.attributesToHighlight,u=t.highlightPreTag,c=t.highlightPostTag,l=t.placeholderSearch,h=t.query,d=t.sort,g=t.pagination,p=t.matchingStrategy,v=f(t.filters,t.numericFilters,t.facetFilters);return{getParams:function(){return e},addFacets:function(){Array.isArray(r)?e.facets=r:"string"==typeof r&&(e.facets=[r])},addAttributesToCrop:function(){n&&(e.attributesToCrop=n)},addCropMarker:function(){null!=i&&(e.cropMarker=i)},addAttributesToRetrieve:function(){a&&(e.attributesToRetrieve=a)},addFilters:function(){v.length&&(e.filter=v)},addAttributesToHighlight:function(){e.attributesToHighlight=o||["*"]},addPreTag:function(){e.highlightPreTag=u||"__ais-highlight__"},addPostTag:function(){e.highlightPostTag=c||"__/ais-highlight__"},addPagination:function(){var t=function(t,e,r){return!!(r||e||t&&0!==t.length)}(v,h,l);if(g.finite){var r=function(t,e){var r=t.page,n=t.hitsPerPage;return e?{hitsPerPage:n,page:r+1}:{hitsPerPage:0,page:r+1}}(g,t),n=r.hitsPerPage,i=r.page;e.hitsPerPage=n,e.page=i}else{var a=function(t,e){var r=t.page,n=t.hitsPerPage;return e?{limit:n+1,offset:r*n}:{limit:0,offset:0}}(g,t),o=a.limit,s=a.offset;e.limit=o,e.offset=s}},addSort:function(){(null==d?void 0:d.length)&&(e.sort=[d])},addGeoSearchRules:function(){var r=function(t){var e={},r=t.aroundLatLng,n=t.aroundLatLngViaIP,i=t.aroundRadius,a=t.aroundPrecision,o=t.minimumAroundRadius,s=t.insideBoundingBox,u=t.insidePolygon;return r&&(e.aroundLatLng=r),n&&console.warn("instant-meilisearch: `aroundLatLngViaIP` is not supported."),i&&(e.aroundRadius=i),a&&console.warn("instant-meilisearch: `aroundPrecision` is not supported.\n    See this discussion to track its implementation https://github.com/meilisearch/product/discussions/264"),o&&(e.minimumAroundRadius=o),s&&(e.insideBoundingBox=s),u&&console.warn("instant-meilisearch: `insidePolygon` is not implented in instant-meilisearch."),e}(t),n=s(r);(null==n?void 0:n.filter)&&(e.filter?e.filter.unshift(n.filter):e.filter=[n.filter])},addMatchingStrategy:function(){p&&(e.matchingStrategy=p)}}}function d(t){return"string"==typeof t?t:void 0===t?JSON.stringify(null):JSON.stringify(t)}function g(t){return Array.isArray(t)?t.map((function(t){return g(t)})):"object"!=typeof(e=t)||Array.isArray(e)||null===e?{value:d(t)}:Object.keys(t).reduce((function(e,r){return e[r]=g(t[r]),e}),{});var e}function p(t,e){var r=e.primaryKey,n=t.hits,i=e.pagination,a=i.finite,o=i.hitsPerPage;!a&&n.length>o&&n.splice(n.length-1,1);var s=n.map((function(t){if(Object.keys(t).length>0){var e=t._formatted;t._matchesPosition;var n=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}(t,["_formatted","_matchesPosition"]),i=Object.assign(n,function(t){if(!t)return{};var e=g(t);return{_highlightResult:e,_snippetResult:e}}(e));return r&&(i.objectID=t[r]),i}return t}));return s=function(t){for(var e,r=0;r<t.length;r++){var n="".concat(r+1e6*Math.random());t[r]._geo&&(t[r]._geoloc=t[r]._geo,t[r].objectID=n),(null===(e=t[r]._formatted)||void 0===e?void 0:e._geo)&&(t[r]._formatted._geoloc=t[r]._formatted._geo,t[r]._formatted.objectID=n)}return t}(s),s}function v(t){void 0===t&&(t={});var e=t;return{getEntry:function(t){if(e[t])try{return JSON.parse(e[t])}catch(r){return e[t]}},formatKey:function(t){return t.reduce((function(t,e){return t+JSON.stringify(e)}),"")},setEntry:function(t,r){e[t]=JSON.stringify(r)},clearCache:function(){e={}}}}function y(t,i){return r(this,void 0,void 0,(function(){var r,a;return n(this,(function(n){switch(n.label){case 0:return r=e(e({},i),{placeholderSearch:!0,query:""}),(a=h(r)).addFacets(),a.addPagination(),[4,t.searchResponse(r,a.getParams())];case 1:return[2,n.sent().facetDistribution||{}]}}))}))}function P(t,e,i){return r(this,void 0,void 0,(function(){var r,a;return n(this,(function(n){switch(n.label){case 0:return i[e.indexUid]?[3,2]:(r=i,a=e.indexUid,[4,y(t,e)]);case 1:r[a]=n.sent(),n.label=2;case 2:return[2,i]}}))}))}var m;exports.MatchingStrategies=void 0,(m=exports.MatchingStrategies||(exports.MatchingStrategies={})).ALL="all",m.LAST="last",exports.instantMeiliSearch=function(i,a,o){void 0===a&&(a=""),void 0===o&&(o={}),function(t,e){if("string"!=typeof t)throw new TypeError("Provided hostUrl value (1st parameter) is not a string, expected string");if("string"!=typeof e&&"function"!=typeof e)throw new TypeError("Provided apiKey value (2nd parameter) is not a string or a function, expected string or function")}(i,a),a=function(t){if("function"==typeof t){var e=t();if("string"!=typeof e)throw new TypeError("Provided apiKey function (2nd parameter) did not return a string, expected string");return e}return t}(a);var s,u,c=function(t){void 0===t&&(t=[]);var e="Meilisearch instant-meilisearch (v".concat("0.11.0",")");return t.concat(e)}(o.clientAgents),l=new t.MeiliSearch({host:i,apiKey:a,clientAgents:c}),f=v(),d=(s=l,u=f,{searchResponse:function(t,e){return r(this,void 0,void 0,(function(){var r,i,a;return n(this,(function(n){switch(n.label){case 0:return r=u.formatKey([e,t.indexUid,t.query,t.pagination]),(i=u.getEntry(r))?[2,i]:[4,s.index(t.indexUid).search(t.query,e)];case 1:return a=n.sent(),u.setEntry(r,a),[2,a]}}))}))}}),g={};return{clearCache:function(){return f.clearCache()},search:function(t){return r(this,void 0,void 0,(function(){var r,i,a,s,u,c,l,f,v;return n(this,(function(n){switch(n.label){case 0:n.trys.push([0,6,,7]),r={results:[]},i=0,a=t,n.label=1;case 1:return i<a.length?(s=a[i],u=function(t,r){var n,i,a,o=t.indexName.split(":"),s=o[0],u=o.slice(1),c=t.params,l=(n=r.finitePagination,i=null==c?void 0:c.hitsPerPage,a=null==c?void 0:c.page,{hitsPerPage:void 0===i?20:i,page:a||0,finite:!!n});return e(e(e({},r),c),{sort:u.join(":")||"",indexUid:s,pagination:l,placeholderSearch:!1!==r.placeholderSearch,keepZeroFacets:!!r.keepZeroFacets})}(s,o),c=function(t){var e=h(t);return e.addFacets(),e.addAttributesToHighlight(),e.addPreTag(),e.addPostTag(),e.addAttributesToRetrieve(),e.addAttributesToCrop(),e.addCropMarker(),e.addPagination(),e.addFilters(),e.addSort(),e.addGeoSearchRules(),e.addMatchingStrategy(),e.getParams()}(u),[4,P(d,u,g)]):[3,5];case 2:return g=n.sent(),[4,d.searchResponse(u,c)];case 3:l=n.sent(),f=function(t,r,n){var i=t.processingTimeMs,a=t.query,o=t.facetDistribution,s=r.keepZeroFacets,u=r.facets,c=function(t,e){var r=e.hitsPerPage,n=e.page,i=function(t,e){if(null!=t.totalPages)return t.totalPages;if(0===e)return 0;var r=t.limit,n=void 0===r?20:r,i=t.offset;return(void 0===i?0:i)/e+1+(t.hits.length>=n?1:0)}(t,r);return{page:n,nbPages:i,hitsPerPage:r}}(t,r.pagination),l=c.hitsPerPage,f=c.page,h=c.nbPages,d=p(t,r),g=function(t){var e=t.hitsPerPage,r=void 0===e?0:e,n=t.totalPages,i=void 0===n?0:n,a=t.estimatedTotalHits,o=t.totalHits;return null!=a?a:null!=o?o:r*i}(t),v=function(t,e,r,n){return t?function(t,e,r){for(var n=function(t){return t?"string"==typeof t?[t]:t:[]}(t),i={},a=0,o=n;a<o.length;a++){var s=o[a];for(var u in e[s])i[s]||(i[s]=r[s]||{}),i[s][u]?i[s][u]=r[s][u]:i[s][u]=0}return i}(e,r,n=n||{}):n}(s,u,n,o);return e({index:r.indexUid,hitsPerPage:l,page:f,facets:v,nbPages:h,nbHits:g,processingTimeMS:i,query:a,hits:d,params:"",exhaustiveNbHits:!1},{})}(l,u,g[s.indexName]),r.results.push(f),n.label=4;case 4:return i++,[3,1];case 5:return[2,r];case 6:throw v=n.sent(),console.error(v),new Error(v);case 7:return[2]}}))}))},searchForFacetValues:function(t){return r(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return[4,new Promise((function(t,e){e(new Error("SearchForFacetValues is not compatible with Meilisearch")),t([])}))];case 1:return[2,t.sent()]}}))}))}}};
//# sourceMappingURL=instant-meilisearch.cjs.min.js.map
